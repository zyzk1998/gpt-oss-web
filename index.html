<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GPT-OSS Galaxy åŠ©æ‰‹</title>
    <!-- å¼•å…¥æ ·å¼åº“ (Bootstrap) å’Œ Markdown è§£æå™¨ (Marked) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        body { background-color: #f4f6f9; height: 100vh; display: flex; flex-direction: column; }
        .chat-container { flex: 1; overflow-y: auto; padding: 20px; max-width: 900px; margin: 0 auto; width: 100%; }
        .message { margin-bottom: 20px; padding: 15px; border-radius: 10px; max-width: 85%; }
        .message.user { background-color: #007bff; color: white; align-self: flex-end; margin-left: auto; }
        .message.system { background-color: white; border: 1px solid #ddd; align-self: flex-start; }
        .input-area { background: white; padding: 20px; border-top: 1px solid #ddd; }
        .input-group { max-width: 900px; margin: 0 auto; }
        pre { background: #2d2d2d; color: #f8f8f2; padding: 10px; border-radius: 5px; }
    </style>
</head>
<body>

    <!-- é¡¶éƒ¨æ ‡é¢˜ -->
    <nav class="navbar navbar-dark bg-dark">
        <div class="container-fluid justify-content-center">
            <span class="navbar-brand mb-0 h1">ğŸ§¬ GPT-OSS BioBlend æ™ºèƒ½åŠ©æ‰‹</span>
        </div>
    </nav>

    <!-- èŠå¤©è®°å½•æ˜¾ç¤ºåŒº -->
    <div class="chat-container d-flex flex-column" id="chatBox">
        <div class="message system">
            ä½ å¥½ï¼æˆ‘æ˜¯ä½ çš„ç”Ÿç‰©ä¿¡æ¯åŠ©æ‰‹ã€‚å·²è¿æ¥ Galaxy çŸ¥è¯†åº“ã€‚<br>
            è¯·å‘Šè¯‰æˆ‘ä½ æƒ³åšä»€ä¹ˆï¼Ÿä¾‹å¦‚ï¼š<b>"æŸ¥è¯¢æˆ‘çš„è´¦æˆ·ä¿¡æ¯"</b> æˆ– <b>"åˆ—å‡ºæ‰€æœ‰å¯ç”¨çš„å·¥å…·"</b>ã€‚
        </div>
    </div>

    <!-- åº•éƒ¨è¾“å…¥åŒº -->
    <div class="input-area">
        <div class="input-group">
            <input type="text" id="userInput" class="form-control" placeholder="è¾“å…¥ä½ çš„éœ€æ±‚..." onkeypress="handleEnter(event)">
            <button class="btn btn-primary" onclick="sendMessage()" id="sendBtn">å‘é€</button>
        </div>
    </div>

    <script>
        const chatBox = document.getElementById('chatBox');
        const userInput = document.getElementById('userInput');
        const sendBtn = document.getElementById('sendBtn');

        function handleEnter(e) {
            if (e.key === 'Enter') sendMessage();
        }

        async function sendMessage() {
            const text = userInput.value.trim();
            if (!text) return;

            // 1. æ˜¾ç¤ºç”¨æˆ·æ¶ˆæ¯
            appendMessage('user', text);
            userInput.value = '';
            userInput.disabled = true;
            sendBtn.disabled = true;
            sendBtn.innerText = "æ€è€ƒä¸­...";

            try {
                // 2. å‘é€è¯·æ±‚ç»™åç«¯ app.py
                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: text })
                });
                
                const data = await response.json();
                
                // 3. æ˜¾ç¤ºç³»ç»Ÿå›å¤ (è§£æ Markdown)
                appendMessage('system', marked.parse(data.reply));
            } catch (error) {
                appendMessage('system', `<span style="color:red">è¯·æ±‚å¤±è´¥: ${error}</span>`);
            } finally {
                userInput.disabled = false;
                sendBtn.disabled = false;
                sendBtn.innerText = "å‘é€";
                userInput.focus();
            }
        }

        function appendMessage(role, htmlContent) {
            const div = document.createElement('div');
            div.className = `message ${role}`;
            div.innerHTML = htmlContent;
            chatBox.appendChild(div);
            chatBox.scrollTop = chatBox.scrollHeight; // è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨
        }
    </script>
</body>
</html>
